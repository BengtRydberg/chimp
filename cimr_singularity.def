Bootstrap: docker

From: continuumio/miniconda3

%files
    /home/simonpf/src/pansat /pansat
    /home/simonpf/src/quantnn /quantnn
    /home/simonpf/src/cimr /cimr

%environment
    export PATH="/opt/conda/bin:$PATH"
    export PATH="/opt/conda/envs/cimr/bin:$PATH"

%post
    apt update
    apt install -y build-essential
    /opt/conda/bin/conda env create -f /cimr/cimr.yml
    /opt/conda/envs/cimr/bin/python3 -m pip install -e /pansat
    /opt/conda/envs/cimr/bin/python3 -m pip install -e /quantnn
    /opt/conda/envs/cimr/bin/python3 -m pip install -e /cimr
    /opt/conda/envs/cimr/bin/python3 -m pip install notebook
    #rm -rf /pansat /quantnn /cimr
    echo ". /opt/conda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
    echo "conda activate cimr" >> $SINGULARITY_ENVIRONMENT

%runscript

    exec "$@"
    
