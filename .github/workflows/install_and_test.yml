name: install_and_test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  install_and_test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.9", "3.10"]
    steps:
        - uses: actions/checkout@v3
        - name: Setup
        uses: conda-incubator/setup-miniconda@v2
        with:
                miniforge-version: latest
                miniforge-variant: mambaforge
                channel-priority: strict
                channels: conda-forge
                show-channel-urls: true
                use-only-tar-bz2: true
        - name: Install dependencies
        run: |
            mamba install --quiet --yes --file chimp.yml
            mamba activate chimp
            pip install pytest pytest-cov
            pip install -e .
        - name: Run tests with pytest
        run: |
            python -m pytest --cov=pytorch_retrieve tests/ --durations=0 -m "not slow"
