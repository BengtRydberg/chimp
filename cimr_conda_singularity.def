Bootstrap: docker

From: mambaorg/micromamba

%files
    /home/simonpf/src/cimr/cimr.yml /cimr.yml
    /home/simonpf/src/cimr/aux/singularity_shell_init.sh /singularity_shell_init.sh

%environment
    export PATH="/opt/conda/bin:$PATH"
    export PATH="/opt/conda/envs/cimr/bin:$PATH"

%post

    micromamba env create -f /cimr.yml
    rm -rf n /cimr.yml
    echo ". /singularity_shell_init.sh" >> $SINGULARITY_ENVIRONMENT
    echo "micromamba activate cimr" >> $SINGULARITY_ENVIRONMENT

%runscript

    exec "$@"
